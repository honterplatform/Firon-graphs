<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Share Of Voice</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  html, body { width: 100%; height: 100%; overflow: hidden; }
  body {
    background: #0A0A0A;
    font-family: system-ui, -apple-system, sans-serif;
    color: #fff;
  }
  .card {
    background: #0F0F0F;
    width: 100%;
    height: 100%;
  }
  .title {
    font-size: 15px;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: #ccc;
  }
  .info-icon {
    width: 18px; height: 18px;
    background: #444;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: #999;
  }
  .chart-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 40px;
  }
  canvas { display: block; }
  .legend {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .legend-item {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    opacity: 0;
    transform: translateX(10px);
    transition: opacity 0.4s ease, transform 0.4s ease;
  }
  .legend-item.visible {
    opacity: 1;
    transform: translateX(0);
  }
  .legend-color {
    width: 13px; height: 13px;
    border-radius: 3px;
    flex-shrink: 0;
  }
  @media (max-width: 480px) {
    .chart-container {
      flex-direction: column;
      gap: 20px;
    }
    canvas {
      width: 160px !important;
      height: 160px !important;
    }
    .legend { align-items: center; }
    .legend-item { font-size: 12px; }
  }
</style>
</head>
<body>
<div class="card">
  <div class="title">Share Of Voice <span class="info-icon">i</span></div>
  <div class="chart-container">
    <canvas id="donut" width="220" height="220"></canvas>
    <div class="legend" id="legend"></div>
  </div>
</div>
<script>
const data = [
  { label: 'target.com', value: 30, color: '#FB3B24' },
  { label: 'magneticme.com', value: 25, color: '#FF7A6B' },
  { label: 'primary.com', value: 22, color: '#FFB0A5' },
  { label: 'stitchfix.com', value: 13, color: '#FDD8D3' },
  { label: 'kohls.com', value: 10, color: '#555555' },
];

const canvas = document.getElementById('donut');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio || 1;
canvas.width = 220 * dpr;
canvas.height = 220 * dpr;
canvas.style.width = '220px';
canvas.style.height = '220px';
ctx.scale(dpr, dpr);

const cx = 110, cy = 110, outerR = 100, innerR = 62;
const total = data.reduce((s, d) => s + d.value, 0);

const legendEl = document.getElementById('legend');
data.forEach(d => {
  const item = document.createElement('div');
  item.className = 'legend-item';
  item.innerHTML = `<div class="legend-color" style="background:${d.color}"></div>${d.label}`;
  legendEl.appendChild(item);
});

function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3); }

const duration = 1500;
let start = null;

function draw(timestamp) {
  if (!start) start = timestamp;
  const elapsed = timestamp - start;
  const progress = Math.min(elapsed / duration, 1);
  const easedProgress = easeOutCubic(progress);
  const maxAngle = easedProgress * Math.PI * 2;

  ctx.clearRect(0, 0, 220, 220);

  let currentAngle = -Math.PI / 2;
  for (const d of data) {
    const sliceAngle = (d.value / total) * Math.PI * 2;
    const drawAngle = Math.min(sliceAngle, Math.max(0, maxAngle - (currentAngle + Math.PI / 2)));
    if (drawAngle > 0) {
      ctx.beginPath();
      ctx.arc(cx, cy, outerR, currentAngle, currentAngle + drawAngle);
      ctx.arc(cx, cy, innerR, currentAngle + drawAngle, currentAngle, true);
      ctx.closePath();
      ctx.fillStyle = d.color;
      ctx.fill();
    }
    currentAngle += sliceAngle;
  }

  if (progress < 1) {
    requestAnimationFrame(draw);
  } else {
    const items = document.querySelectorAll('.legend-item');
    items.forEach((item, i) => {
      setTimeout(() => item.classList.add('visible'), i * 120);
    });
  }
}

requestAnimationFrame(draw);
</script>
</body>
</html>
